docker

# Docker

## Containerization
> Packaging an application with its dependencies so that it can be run anywhere independently.
- runs the application in an isolated environment
- uses the shared operating system


Advantages:
- security
- flexible - allows for looser coupling
- scalable - easy to create more
- continuity - failure in one system does not affect the other

### Container vs Virtual Machine
- VM has the full operating system
- Containers use the host machine's operating system


Containers Advantages over VMs
- lightweight
- minimal boot time 

Disadvantages vs VM:
- less secure
- no hardware storage separation
- difficulty of monitoring many concainers


Often they are used together, like when a  Micro Services Application runs on an EC2 which has docker installed that runs several containers.


## Docker
> Tool to achieve containerization. A PaaS service that uses OS-level virtualization to deliver a software in packages called containers.


Docker adheres to a client(CLI) - server (Daemon) architecture


### Docker Who is Who
#### CLI 
>Allows you to run docker commands

#### Daemon
>Manages docker objects
- docker objects: building blocks managed by the daemon
- main docker objects
    - images
    - container

#### Docker Images
> Blueprint for a docker container.
- can be built on top of another
- one image per container, but can be multiple containers from the same image
- images can have versions

#### Dockerfile
> Defines everything needed to build a docker container


#### Docker Registry
> Centralized repository to store and share images

- DockerHub
    - `docker pull` to retreive image
    - `docker push` to store image

#### Docker Volume
>A Docker volume is a mechanism for persisting data generated by and used by Docker containers. - 

Docker volumes are completely managed by Docker and are stored in a part of the host filesystem which is managed by Docker (/var/lib/docker/volumes/ on Linux).

### Docker Application Flow
1. Use CLI to tell Daemon to acquire an image.
    - with `docker pull` from a registry
    - or with `docker build` build one from a docker file
2. Daemon acquires image 
3. Use CLI to start container with `docker run`
```bash
docker run -d -p 8080:80 --name my_container my_image
```
- `-d` runs the container in detached mode, which means it runs in the background.
- `-p 8080:80` maps port 80 in the container to port 8080 on the host system.
- `--name my_container` gives the container a name for easier reference.
- `my_image` is the name of the Docker image to use to create the container.
4. Daemon spins up container based on image
5. Manage container with CLI

If the primary process of the conatiner finishes the container will stop on its own.


### CLI commands
```bash
$ docker image ls List your images.


$ docker image rm [image name] Delete a specific image.


$ docker image rm $(docker images -a -q) Delete all existing images.


$ docker ps -a List all existing containers (running and not running).


$ docker stop [container name] Stop a specific container.


$ docker stop $(docker ps -a -q) Stop all running containers.


$ docker rm [container name] Delete a specific container (only if stopped).


$ docker rm $(docker ps -a -q) Delete all containers (only if stopped).


$ docker logs [container name] Display logs of a container.


$ docker start [CONTAINER] Start a container.


$ docker stop [CONTAINER] Stop a running container.


$ docker restart [CONTAINER] Stop a running container and start it up again.

```
### How to build an image

#### Create DockerFile

```bash
# the image you build from
FROM <image-name>

# set working directory in inside the container
WORKDIR /usr/src/app

# copy files to workind directory
COPY my-app.jar ./

# environment vairables
ENV

# can expose a port for the application to liston on
EXPOSE 8080

# can have several run commands
# to build a file for exampl
RUN
RUN


# command to start an app ONLY ONE
CMD java app.jar
```

#### Build image from docker file
`docker build -t my-java-app`

## Docker commands

```bash
# List your images.
$ docker image ls

# Delete a specific image.
$ docker image rm [image name] 

# Delete all existing images.
$ docker image rm $(docker images -a -q)

# List all existing containers (running and not running).
$ docker ps -a 

# Stop a specific container.
$ docker stop [container name] 

# Stop all running containers.
$ docker stop $(docker ps -a -q) 

# Delete a specific container (only if stopped).
$ docker rm [container name]

# Delete all containers (only if stopped).
$ docker rm $(docker ps -a -q) 

# Display logs of a container.
$ docker logs [container name] 

# Start a container:
$ docker start [CONTAINER] 

# Stop a running container:
$ docker stop [CONTAINER] Stop a running container and start it up again:
$ docker restart [CONTAINER]

```